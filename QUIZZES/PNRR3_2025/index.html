// Funzione per mostrare la domanda corrente (MODIFICATA)
function showQuestion() {
    const quizContainer = document.getElementById('quiz-container');
    const currentQuestion = currentQuestions[currentQuestionIndex];
    
    // Crea il contenitore della domanda
    const questionDiv = document.createElement('div');
    questionDiv.className = 'question-container';
    
    // Aggiungi la categoria
    const categoryDiv = document.createElement('div');
    categoryDiv.className = 'category';
    categoryDiv.textContent = currentQuestion.category;
    questionDiv.appendChild(categoryDiv);
    
    // Aggiungi il testo della domanda
    const questionText = document.createElement('div');
    questionText.className = 'question-text';
    questionText.textContent = `${currentQuestionIndex + 1}. ${currentQuestion.text}`;
    questionDiv.appendChild(questionText);
    
    // Crea il contenitore delle opzioni
    const optionsContainer = document.createElement('div');
    optionsContainer.className = 'options-container';
    
    // Mescola le opzioni ma ricorda quale è quella corretta (la prima nell'array originale)
    const correctAnswer = currentQuestion.options[0];
    const shuffledOptions = shuffleArray([...currentQuestion.options]);
    
    // Per ogni opzione, crea un elemento
    shuffledOptions.forEach((option, index) => {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'option';
        optionDiv.textContent = option;
        
        // Se l'utente ha già risposto a questa domanda, evidenzia la risposta
        if (userAnswers[currentQuestionIndex] !== undefined) {
            if (option === correctAnswer) {
                optionDiv.classList.add('correct');
            } else if (option === userAnswers[currentQuestionIndex] && option !== correctAnswer) {
                optionDiv.classList.add('incorrect');
            }
        }
        
        optionDiv.addEventListener('click', () => {
            if (quizCompleted) return;
            
            // Rimuovi la selezione da tutte le opzioni
            const allOptions = optionsContainer.querySelectorAll('.option');
            allOptions.forEach(opt => opt.classList.remove('selected'));
            
            // Aggiungi la selezione all'opzione cliccata
            optionDiv.classList.add('selected');
            
            // Salva la risposta dell'utente
            userAnswers[currentQuestionIndex] = option;
            
            // MODIFICA: Evidenzia immediatamente la risposta corretta e quella sbagliata
            allOptions.forEach(opt => {
                // Rimuovi eventuali evidenziazioni precedenti
                opt.classList.remove('correct', 'incorrect');
                
                // Evidenzia la risposta corretta in verde
                if (opt.textContent === correctAnswer) {
                    opt.classList.add('correct');
                }
                // Evidenzia la risposta selezionata in rosso se è sbagliata
                else if (opt === optionDiv && option !== correctAnswer) {
                    opt.classList.add('incorrect');
                }
            });
            
            // Abilita il pulsante successivo se non siamo all'ultima domanda
            if (currentQuestionIndex < currentQuestions.length - 1) {
                document.getElementById('next-btn').disabled = false;
            } else {
                document.getElementById('next-btn').textContent = 'Mostra Risultati';
            }
        });
        
        optionsContainer.appendChild(optionDiv);
    });
    
    questionDiv.appendChild(optionsContainer);
    quizContainer.innerHTML = '';
    quizContainer.appendChild(questionDiv);
    
    // Aggiorna lo stato dei pulsanti di navigazione
    document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
}
